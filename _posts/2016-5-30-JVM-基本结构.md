---
layout: post
title: JVM-基本结构
date:   2016-5-30
categories: "JVM"
tags: [java, jvm]
author: Mark
comment: false
---

> 作为一名java程序员，了解jvm体系结构至关重要，有助于我们写出更高效的代码。

## 基本结构

> 虚拟机是物理机器的软件实现，java遵循WORA（编写一次，到处运行）理念，它运行在VM之上。编译器将java文件编译成class文件，将class文件输入到JVM中，加载并执行该类文件。

![JVM体系结构][1]

## 类加载器子系统
后续有专门的篇幅讲解。
## 运行时数据区
> JVM在执行java程序的过程中，会把它所管理的内存区域分为若干个数据区域。这些区域都有各自的用途，创建和销毁时间，有的区域随虚拟机进程启动而存在，有的区域随用户线程的启动和结束而创建和销毁。

#### 程序计数器
　　程序计数器是一块较小的内存空间，它是当前线程执行字节码的行号指示器，如果当前线程执行的是java方法，这个计数器记录正在执行的虚拟机字节码指令的地址，如果是一个Native方法，则该计数器为空（Undefined）。<br />
　　java虚拟机多线程是通过线程轮流切换并分配处理器执行时间实现，在一个确定的时刻，一个处理器都会执行一个线程指令，为了线程切换后回到正确的执行位置，每个线程都需要一个独立的程序计数器，各个计数器之间独立存储，互不影响，称为“线程私有”空间，**此内存区域是唯一一个在java虚拟机规范中没有规定任何OutOfMemoryError情况的区域**。

#### 虚拟机栈
　　和程序计数器一样，虚拟机栈也是线程私有的，它的生命周期和线程相同。虚拟机栈描述的是java方法执行的内存模型：每个方法执行的同时都会创建一个栈帧用于存储局部变量表，操作数栈，动态链接，方法出口等信息。每个方法从调用到执行完成，就对应着一个栈帧在虚拟机栈中入栈和出栈的过程。
##### 局部变量表：
1. 基本数据类型
byte、shot、int 、boolean、double、char 占用一个局部变量空间 float、long 占用两个局部变量空间。

2. 对象引用
reference类型，他不等同于对象本身，可能是一个指向对象起始地址的一用指针，也可能是指向一个对象的句柄或其他与此对象相关的位置。

3. returnAddress类型
指向了一条字节码指令的地址。

##### 两种异常情况：
1. StackOverFlowError 

　　线程请求的栈深度大于虚拟机所允许的深度。

2. OutOfMemoryError 

　　如果虚拟机栈可以动态扩展（当前大部分的Java虚拟机都可以动态扩展，只不过Java虚拟机规范中也允许固定长度的虚拟机栈），如果扩展时无法申请到足够的内存，就会抛出此异常。


 #### 本地方法栈
 　　本地方法栈与虚拟机栈发挥的作用是非常相似的，区别是虚拟机栈为执行Java方法服务，本地方法栈则为虚拟机使用到的Native方法服务，与虚拟机栈一样，本地方法栈也会抛出StackOverFlowError和OutOfMemoryError异常。


  [1]: http://www.javainterviewpoint.com/wp-content/uploads/2016/01/JVM-Architecture.png